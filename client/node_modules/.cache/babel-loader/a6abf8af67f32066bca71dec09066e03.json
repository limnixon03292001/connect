{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Lim\\\\Desktop\\\\Clone\\\\login-mern\\\\client\\\\src\\\\components\\\\Homepage\\\\components\\\\Middle.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { useSelector } from 'react-redux';\nimport { useHistory, Link } from 'react-router-dom';\nimport { useDispatch } from 'react-redux';\nimport { createPost } from '../../../redux/actions/post';\nimport Post from './Post/Post';\nimport CreatePost from '../../layout/CreatePost';\nimport PostLoading from '../../layout/Skeleton Loading/Post';\nimport Search from '../../layout/Search';\nimport MobileProfile from '../../layout/Skeleton Loading/MobileProfile';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initialState = {\n  description: '',\n  postImg: ''\n};\n\nconst Middle = () => {\n  _s();\n\n  var _authUser$authData, _authUser$authData2, _authUser$authData3, _authUser$authData4, _authUser$authData5, _authUser$authData6;\n\n  const [modalOpen, setModalOpen] = useState(false);\n  const [postData, setpostData] = useState(initialState);\n  const [pageNumber, setPageNumber] = useState(1);\n  const [hasMore, setHasMore] = useState(false);\n  const authUser = useSelector(state => state.auth);\n  const [blob, setBlob] = useState('');\n  let post = useSelector(state => state.posts);\n  const history = useHistory();\n  const dispatch = useDispatch();\n\n  const clear = () => {\n    setpostData({\n      description: '',\n      postImg: ''\n    });\n  };\n\n  const handleBlob = e => {\n    setBlob(URL.createObjectURL(e.target.files[0]));\n  };\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    const myForm = e.target;\n    const formData = new FormData(myForm);\n\n    if (postData.description === '' && blob === '') {\n      alert('Posting without a content is not allowed!');\n    } else {\n      dispatch(createPost(formData, setModalOpen));\n    }\n\n    clear();\n  }; //turn the post state to an empty array every first render \n\n\n  useEffect(() => {\n    dispatch({\n      type: 'RESET_POSTS'\n    });\n  }, [dispatch]);\n  useEffect(() => {\n    // dispatch(fetchPostsLimit(history, pageNumber, setHasMore, CancelToken, cancel));\n    // this cancelToken is for cancelling an API request everytime the components unmount\n    const CancelToken = axios.CancelToken;\n    let cancel;\n    dispatch({\n      type: 'POSTS_LOADING'\n    });\n    axios.get(`/post/post?page=${pageNumber}`, {\n      cancelToken: new CancelToken(function executor(c) {\n        // An executor function receives a cancel function as a parameter\n        cancel = c;\n      })\n    }).then(({\n      data\n    }) => {\n      setHasMore(data.result.length > 0);\n      dispatch({\n        type: 'POSTS',\n        payload: data\n      });\n    }).catch(error => {\n      if (axios.isCancel(error)) {\n        console.log('Request Canceled sa post!');\n      } else {\n        var _error$response;\n\n        dispatch({\n          type: 'ERRORS',\n          payload: error\n        });\n\n        if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401) {\n          dispatch({\n            type: 'LOGOUT'\n          });\n          history.push('/login');\n        }\n      }\n    });\n    return () => cancel();\n  }, [dispatch, history, pageNumber]);\n  const observer = useRef();\n  const lastBookElementRef = useCallback(node => {\n    if (post.loading) return;\n    if (observer.current) observer.current.disconnect();\n    observer.current = new IntersectionObserver(entries => {\n      if (entries[0].isIntersecting && hasMore) {\n        setPageNumber(prevPageNumber => prevPageNumber + 1);\n      }\n    }, {\n      rootMargin: \"-150px\"\n    });\n    if (node) observer.current.observe(node);\n  }, [post.loading, hasMore]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"lg:col-span-9 xl:col-span-6 col-span-full space-y-3 mb-16 md:mb-0\",\n    children: [/*#__PURE__*/_jsxDEV(Search, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"space-y-4 md:space-y-5\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-2 md:hidden\",\n        children: (authUser === null || authUser === void 0 ? void 0 : authUser.loading) ? /*#__PURE__*/_jsxDEV(MobileProfile, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 38\n        }, this) : /*#__PURE__*/_jsxDEV(Link, {\n          to: `/profile/${(_authUser$authData = authUser.authData) === null || _authUser$authData === void 0 ? void 0 : _authUser$authData._id}`,\n          className: \"flex items-center justify-center gap-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: (_authUser$authData2 = authUser.authData) === null || _authUser$authData2 === void 0 ? void 0 : _authUser$authData2.imageUrl,\n            alt: (_authUser$authData3 = authUser.authData) === null || _authUser$authData3 === void 0 ? void 0 : _authUser$authData3.imageUrl,\n            className: \"h-12 w-12 rounded-md object-cover bg-pruple-400\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 112,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex flex-col justify-center\",\n            children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n              className: \"text-md font-semibold\",\n              children: [(_authUser$authData4 = authUser.authData) === null || _authUser$authData4 === void 0 ? void 0 : _authUser$authData4.firstname, \" \", (_authUser$authData5 = authUser.authData) === null || _authUser$authData5 === void 0 ? void 0 : _authUser$authData5.lastname]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 114,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-sm text-gray-200\",\n              children: (_authUser$authData6 = authUser.authData) === null || _authUser$authData6 === void 0 ? void 0 : _authUser$authData6.email\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 115,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 113,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 18\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(CreatePost, {\n        handleSubmit: handleSubmit,\n        postData: postData,\n        setpostData: setpostData,\n        post: post,\n        modalOpen: modalOpen,\n        setModalOpen: setModalOpen,\n        handleBlob: handleBlob,\n        setBlob: setBlob,\n        blob: blob\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 13\n      }, this), (post === null || post === void 0 ? void 0 : post.posts.length) === 0 ? /*#__PURE__*/_jsxDEV(PostLoading, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 46\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"space-y-5\",\n        children: [post.posts.map((postx, index) => {\n          if ((post === null || post === void 0 ? void 0 : post.posts.length) === index + 1) {\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              ref: lastBookElementRef,\n              children: /*#__PURE__*/_jsxDEV(Post, {\n                post: postx\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 132,\n                columnNumber: 41\n              }, this)\n            }, postx._id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 131,\n              columnNumber: 38\n            }, this);\n          } else if (postx === 0) {\n            return null;\n          } else {\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              children: /*#__PURE__*/_jsxDEV(Post, {\n                post: postx\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 140,\n                columnNumber: 41\n              }, this)\n            }, postx._id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 139,\n              columnNumber: 38\n            }, this);\n          }\n        }), !hasMore && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-center text-sm\",\n          children: \"There are no more posts to show right now.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 34\n        }, this), post.loading && /*#__PURE__*/_jsxDEV(PostLoading, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 38\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 105,\n    columnNumber: 9\n  }, this);\n};\n\n_s(Middle, \"Y1F1y6jaRbD1JKa8/jDzayiTrmo=\", false, function () {\n  return [useSelector, useSelector, useHistory, useDispatch];\n});\n\n_c = Middle;\nexport default Middle;\n\nvar _c;\n\n$RefreshReg$(_c, \"Middle\");","map":{"version":3,"sources":["C:/Users/Lim/Desktop/Clone/login-mern/client/src/components/Homepage/components/Middle.js"],"names":["React","useState","useEffect","useRef","useCallback","useSelector","useHistory","Link","useDispatch","createPost","Post","CreatePost","PostLoading","Search","MobileProfile","axios","initialState","description","postImg","Middle","modalOpen","setModalOpen","postData","setpostData","pageNumber","setPageNumber","hasMore","setHasMore","authUser","state","auth","blob","setBlob","post","posts","history","dispatch","clear","handleBlob","e","URL","createObjectURL","target","files","handleSubmit","preventDefault","myForm","formData","FormData","alert","type","CancelToken","cancel","get","cancelToken","executor","c","then","data","result","length","payload","catch","error","isCancel","console","log","response","status","push","observer","lastBookElementRef","node","loading","current","disconnect","IntersectionObserver","entries","isIntersecting","prevPageNumber","rootMargin","observe","authData","_id","imageUrl","firstname","lastname","email","map","postx","index"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,MAArC,EAA6CC,WAA7C,QAAgE,OAAhE;AACA,SAASC,WAAT,QAA4B,aAA5B;AACA,SAAQC,UAAR,EAAoBC,IAApB,QAA+B,kBAA/B;AACA,SAASC,WAAT,QAA4B,aAA5B;AAEA,SAAQC,UAAR,QAAyB,6BAAzB;AAEA,OAAOC,IAAP,MAAiB,aAAjB;AAEA,OAAOC,UAAP,MAAuB,yBAAvB;AACA,OAAOC,WAAP,MAAwB,oCAAxB;AACA,OAAOC,MAAP,MAAmB,qBAAnB;AACA,OAAOC,aAAP,MAA0B,6CAA1B;AAEA,OAAOC,KAAP,MAAkB,OAAlB;;AAEA,MAAMC,YAAY,GAAG;AAAEC,EAAAA,WAAW,EAAE,EAAf;AAAmBC,EAAAA,OAAO,EAAE;AAA5B,CAArB;;AACA,MAAMC,MAAM,GAAG,MAAM;AAAA;;AAAA;;AAEjB,QAAM,CAACC,SAAD,EAAYC,YAAZ,IAA4BpB,QAAQ,CAAC,KAAD,CAA1C;AACA,QAAM,CAACqB,QAAD,EAAUC,WAAV,IAAyBtB,QAAQ,CAACe,YAAD,CAAvC;AACA,QAAM,CAACQ,UAAD,EAAaC,aAAb,IAA8BxB,QAAQ,CAAC,CAAD,CAA5C;AACA,QAAM,CAACyB,OAAD,EAAUC,UAAV,IAAwB1B,QAAQ,CAAC,KAAD,CAAtC;AACA,QAAM2B,QAAQ,GAAGvB,WAAW,CAACwB,KAAK,IAAIA,KAAK,CAACC,IAAhB,CAA5B;AACA,QAAM,CAACC,IAAD,EAAOC,OAAP,IAAkB/B,QAAQ,CAAC,EAAD,CAAhC;AAEA,MAAIgC,IAAI,GAAG5B,WAAW,CAACwB,KAAK,IAAIA,KAAK,CAACK,KAAhB,CAAtB;AACA,QAAMC,OAAO,GAAG7B,UAAU,EAA1B;AACA,QAAM8B,QAAQ,GAAG5B,WAAW,EAA5B;;AAEA,QAAM6B,KAAK,GAAG,MAAM;AAChBd,IAAAA,WAAW,CAAC;AAACN,MAAAA,WAAW,EAAE,EAAd;AAAkBC,MAAAA,OAAO,EAAC;AAA1B,KAAD,CAAX;AACH,GAFD;;AAIA,QAAMoB,UAAU,GAAIC,CAAD,IAAO;AACtBP,IAAAA,OAAO,CAACQ,GAAG,CAACC,eAAJ,CAAoBF,CAAC,CAACG,MAAF,CAASC,KAAT,CAAe,CAAf,CAApB,CAAD,CAAP;AACH,GAFD;;AAIA,QAAMC,YAAY,GAAIL,CAAD,IAAO;AACxBA,IAAAA,CAAC,CAACM,cAAF;AACA,UAAMC,MAAM,GAAGP,CAAC,CAACG,MAAjB;AACA,UAAMK,QAAQ,GAAG,IAAIC,QAAJ,CAAaF,MAAb,CAAjB;;AAEA,QAAGxB,QAAQ,CAACL,WAAT,KAAyB,EAAzB,IAA+Bc,IAAI,KAAK,EAA3C,EAA+C;AAC3CkB,MAAAA,KAAK,CAAC,2CAAD,CAAL;AACH,KAFD,MAEK;AACDb,MAAAA,QAAQ,CAAC3B,UAAU,CAACsC,QAAD,EAAW1B,YAAX,CAAX,CAAR;AACH;;AAEDgB,IAAAA,KAAK;AACR,GAZD,CArBiB,CAoCjB;;;AACAnC,EAAAA,SAAS,CAAC,MAAM;AACZkC,IAAAA,QAAQ,CAAC;AAACc,MAAAA,IAAI,EAAE;AAAP,KAAD,CAAR;AACH,GAFQ,EAEP,CAACd,QAAD,CAFO,CAAT;AAIAlC,EAAAA,SAAS,CAAC,MAAK;AAEX;AAEC;AACA,UAAMiD,WAAW,GAAGpC,KAAK,CAACoC,WAA1B;AACA,QAAIC,MAAJ;AAEDhB,IAAAA,QAAQ,CAAC;AAACc,MAAAA,IAAI,EAAC;AAAN,KAAD,CAAR;AACAnC,IAAAA,KAAK,CAACsC,GAAN,CAAW,mBAAkB7B,UAAW,EAAxC,EAA2C;AAAE8B,MAAAA,WAAW,EAAE,IAAIH,WAAJ,CAAgB,SAASI,QAAT,CAAkBC,CAAlB,EAAqB;AAC3F;AACAJ,QAAAA,MAAM,GAAGI,CAAT;AACD,OAHuD;AAAf,KAA3C,EAGQC,IAHR,CAGa,CAAC;AAACC,MAAAA;AAAD,KAAD,KAAU;AACnB/B,MAAAA,UAAU,CAAC+B,IAAI,CAACC,MAAL,CAAYC,MAAZ,GAAqB,CAAtB,CAAV;AACAxB,MAAAA,QAAQ,CAAC;AAACc,QAAAA,IAAI,EAAE,OAAP;AAAgBW,QAAAA,OAAO,EAAEH;AAAzB,OAAD,CAAR;AACH,KAND,EAMGI,KANH,CAMUC,KAAD,IAAW;AAChB,UAAIhD,KAAK,CAACiD,QAAN,CAAeD,KAAf,CAAJ,EAA2B;AACvBE,QAAAA,OAAO,CAACC,GAAR,CAAY,2BAAZ;AACH,OAFD,MAGI;AAAA;;AACA9B,QAAAA,QAAQ,CAAC;AAACc,UAAAA,IAAI,EAAC,QAAN;AAAgBW,UAAAA,OAAO,EAAEE;AAAzB,SAAD,CAAR;;AACA,YAAG,oBAAAA,KAAK,CAACI,QAAN,oEAAgBC,MAAhB,MAA2B,GAA9B,EAAkC;AAC9BhC,UAAAA,QAAQ,CAAC;AAACc,YAAAA,IAAI,EAAE;AAAP,WAAD,CAAR;AACAf,UAAAA,OAAO,CAACkC,IAAR,CAAa,QAAb;AACH;AACJ;AACJ,KAjBD;AAmBA,WAAO,MAAMjB,MAAM,EAAnB;AACH,GA7BQ,EA6BP,CAAChB,QAAD,EAAUD,OAAV,EAAkBX,UAAlB,CA7BO,CAAT;AAgCA,QAAM8C,QAAQ,GAAGnE,MAAM,EAAvB;AAEA,QAAMoE,kBAAkB,GAAGnE,WAAW,CAAEoE,IAAD,IAAU;AAC7C,QAAGvC,IAAI,CAACwC,OAAR,EAAiB;AACjB,QAAGH,QAAQ,CAACI,OAAZ,EAAqBJ,QAAQ,CAACI,OAAT,CAAiBC,UAAjB;AACrBL,IAAAA,QAAQ,CAACI,OAAT,GAAmB,IAAIE,oBAAJ,CAAyBC,OAAO,IAAI;AACnD,UAAGA,OAAO,CAAC,CAAD,CAAP,CAAWC,cAAX,IAA6BpD,OAAhC,EAAwC;AACpCD,QAAAA,aAAa,CAACsD,cAAc,IAAIA,cAAc,GAAG,CAApC,CAAb;AACH;AACJ,KAJkB,EAIhB;AAACC,MAAAA,UAAU,EAAE;AAAb,KAJgB,CAAnB;AAKA,QAAGR,IAAH,EAASF,QAAQ,CAACI,OAAT,CAAiBO,OAAjB,CAAyBT,IAAzB;AACZ,GATqC,EASpC,CAACvC,IAAI,CAACwC,OAAN,EAAe/C,OAAf,CAToC,CAAtC;AAWA,sBACI;AAAK,IAAA,SAAS,EAAC,mEAAf;AAAA,4BACI,QAAC,MAAD;AAAA;AAAA;AAAA;AAAA,YADJ,eAGA;AAAK,MAAA,SAAS,EAAC,wBAAf;AAAA,8BACI;AAAK,QAAA,SAAS,EAAC,eAAf;AAAA,kBACK,CAAAE,QAAQ,SAAR,IAAAA,QAAQ,WAAR,YAAAA,QAAQ,CAAE6C,OAAV,iBAAoB,QAAC,aAAD;AAAA;AAAA;AAAA;AAAA,gBAApB,gBACA,QAAC,IAAD;AAAM,UAAA,EAAE,EAAG,YAAD,sBAAY7C,QAAQ,CAACsD,QAArB,uDAAY,mBAAmBC,GAAI,EAA7C;AAAgD,UAAA,SAAS,EAAC,wCAA1D;AAAA,kCACG;AAAK,YAAA,GAAG,yBAAEvD,QAAQ,CAACsD,QAAX,wDAAE,oBAAmBE,QAA7B;AAAuC,YAAA,GAAG,yBAAExD,QAAQ,CAACsD,QAAX,wDAAE,oBAAmBE,QAA/D;AAAyE,YAAA,SAAS,EAAC;AAAnF;AAAA;AAAA;AAAA;AAAA,kBADH,eAEG;AAAK,YAAA,SAAS,EAAC,8BAAf;AAAA,oCACA;AAAI,cAAA,SAAS,EAAC,uBAAd;AAAA,gDAAuCxD,QAAQ,CAACsD,QAAhD,wDAAuC,oBAAmBG,SAA1D,8BAAsEzD,QAAQ,CAACsD,QAA/E,wDAAsE,oBAAmBI,QAAzF;AAAA;AAAA;AAAA;AAAA;AAAA,oBADA,eAEI;AAAG,cAAA,SAAS,EAAC,uBAAb;AAAA,+CAAsC1D,QAAQ,CAACsD,QAA/C,wDAAsC,oBAAmBK;AAAzD;AAAA;AAAA;AAAA;AAAA,oBAFJ;AAAA;AAAA;AAAA;AAAA;AAAA,kBAFH;AAAA;AAAA;AAAA;AAAA;AAAA;AAFL;AAAA;AAAA;AAAA;AAAA,cADJ,eAaI,QAAC,UAAD;AAAY,QAAA,YAAY,EAAE3C,YAA1B;AAAwC,QAAA,QAAQ,EAAEtB,QAAlD;AAA4D,QAAA,WAAW,EAAEC,WAAzE;AAAsF,QAAA,IAAI,EAAEU,IAA5F;AAAkG,QAAA,SAAS,EAAEb,SAA7G;AAAwH,QAAA,YAAY,EAAEC,YAAtI;AAAoJ,QAAA,UAAU,EAAEiB,UAAhK;AAA4K,QAAA,OAAO,EAAEN,OAArL;AAA8L,QAAA,IAAI,EAAED;AAApM;AAAA;AAAA;AAAA;AAAA,cAbJ,EAiBS,CAAAE,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAEC,KAAN,CAAY0B,MAAZ,MAAuB,CAAvB,gBAA4B,QAAC,WAAD;AAAA;AAAA;AAAA;AAAA,cAA5B,gBACG;AAAK,QAAA,SAAS,EAAC,WAAf;AAAA,mBACC3B,IAAI,CAACC,KAAL,CAAWsD,GAAX,CAAe,CAACC,KAAD,EAAQC,KAAR,KAAkB;AAE9B,cAAG,CAAAzD,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAEC,KAAN,CAAY0B,MAAZ,MAAuB8B,KAAK,GAAG,CAAlC,EAAoC;AAEhC,gCAAS;AAAqB,cAAA,GAAG,EAAEnB,kBAA1B;AAAA,qCACG,QAAC,IAAD;AAAM,gBAAA,IAAI,EAAEkB;AAAZ;AAAA;AAAA;AAAA;AAAA;AADH,eAAUA,KAAK,CAACN,GAAhB;AAAA;AAAA;AAAA;AAAA,oBAAT;AAIH,WAND,MAMO,IAAGM,KAAK,KAAK,CAAb,EAAe;AAClB,mBAAO,IAAP;AACH,WAFM,MAGC;AACJ,gCAAS;AAAA,qCACG,QAAC,IAAD;AAAM,gBAAA,IAAI,EAAEA;AAAZ;AAAA;AAAA;AAAA;AAAA;AADH,eAAUA,KAAK,CAACN,GAAhB;AAAA;AAAA;AAAA;AAAA,oBAAT;AAGH;AAEA,SAjBJ,CADD,EAoBC,CAACzD,OAAD,iBAAY;AAAG,UAAA,SAAS,EAAC,qBAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBApBb,EAqBCO,IAAI,CAACwC,OAAL,iBAAgB,QAAC,WAAD;AAAA;AAAA;AAAA;AAAA,gBArBjB;AAAA;AAAA;AAAA;AAAA;AAAA,cAlBZ;AAAA;AAAA;AAAA;AAAA;AAAA,YAHA;AAAA;AAAA;AAAA;AAAA;AAAA,UADJ;AAqDH,CA3ID;;GAAMtD,M;UAMed,W,EAGNA,W,EACKC,U,EACCE,W;;;KAXfW,M;AA6IN,eAAeA,MAAf","sourcesContent":["import React, { useState, useEffect, useRef ,useCallback } from 'react'\r\nimport { useSelector } from 'react-redux';\r\nimport {useHistory, Link} from 'react-router-dom';\r\nimport { useDispatch } from 'react-redux';\r\n\r\nimport {createPost} from '../../../redux/actions/post';\r\n\r\nimport Post from './Post/Post';\r\n\r\nimport CreatePost from '../../layout/CreatePost';\r\nimport PostLoading from '../../layout/Skeleton Loading/Post';\r\nimport Search from '../../layout/Search';\r\nimport MobileProfile from '../../layout/Skeleton Loading/MobileProfile';\r\n\r\nimport axios from 'axios';\r\n\r\nconst initialState = { description: '', postImg: ''};\r\nconst Middle = () => {\r\n\r\n    const [modalOpen, setModalOpen] = useState(false);\r\n    const [postData,setpostData] = useState(initialState);\r\n    const [pageNumber, setPageNumber] = useState(1);\r\n    const [hasMore, setHasMore] = useState(false);\r\n    const authUser = useSelector(state => state.auth);\r\n    const [blob, setBlob] = useState('');\r\n\r\n    let post = useSelector(state => state.posts);\r\n    const history = useHistory();\r\n    const dispatch = useDispatch();\r\n\r\n    const clear = () => {\r\n        setpostData({description: '', postImg:''});\r\n    }\r\n\r\n    const handleBlob = (e) => {\r\n        setBlob(URL.createObjectURL(e.target.files[0]));\r\n    }\r\n\r\n    const handleSubmit = (e) => {\r\n        e.preventDefault();\r\n        const myForm = e.target;\r\n        const formData = new FormData(myForm);\r\n\r\n        if(postData.description === '' && blob === '' ){\r\n            alert('Posting without a content is not allowed!')\r\n        }else{\r\n            dispatch(createPost(formData, setModalOpen));\r\n        }\r\n     \r\n        clear();\r\n    }; \r\n  \r\n\r\n    //turn the post state to an empty array every first render \r\n    useEffect(() => {\r\n        dispatch({type: 'RESET_POSTS'});\r\n    },[dispatch]);\r\n\r\n    useEffect(()=> {\r\n         \r\n        // dispatch(fetchPostsLimit(history, pageNumber, setHasMore, CancelToken, cancel));\r\n\r\n         // this cancelToken is for cancelling an API request everytime the components unmount\r\n         const CancelToken = axios.CancelToken;\r\n         let cancel;\r\n\r\n        dispatch({type:'POSTS_LOADING'});\r\n        axios.get(`/post/post?page=${pageNumber}`, { cancelToken: new CancelToken(function executor(c) {\r\n            // An executor function receives a cancel function as a parameter\r\n            cancel = c;\r\n          }) }).then(({data})=>{\r\n            setHasMore(data.result.length > 0);\r\n            dispatch({type: 'POSTS', payload: data});\r\n        }).catch((error) => {\r\n            if (axios.isCancel(error)) {\r\n                console.log('Request Canceled sa post!'); \r\n            }\r\n            else{\r\n                dispatch({type:'ERRORS', payload: error});\r\n                if(error.response?.status === 401){\r\n                    dispatch({type: 'LOGOUT'});\r\n                    history.push('/login');\r\n                }\r\n            }\r\n        });\r\n\r\n        return () => cancel();\r\n    },[dispatch,history,pageNumber]);\r\n\r\n\r\n    const observer = useRef();\r\n   \r\n    const lastBookElementRef = useCallback((node) => {\r\n        if(post.loading) return \r\n        if(observer.current) observer.current.disconnect();\r\n        observer.current = new IntersectionObserver(entries => {\r\n            if(entries[0].isIntersecting && hasMore){\r\n                setPageNumber(prevPageNumber => prevPageNumber + 1);\r\n            }\r\n        }, {rootMargin: \"-150px\"})\r\n        if(node) observer.current.observe(node);\r\n    },[post.loading, hasMore])\r\n    \r\n    return (\r\n        <div className=\"lg:col-span-9 xl:col-span-6 col-span-full space-y-3 mb-16 md:mb-0\">\r\n            <Search />\r\n            \r\n        <div className=\"space-y-4 md:space-y-5\">\r\n            <div className=\"p-2 md:hidden\">\r\n                {authUser?.loading ? <MobileProfile /> :\r\n                 <Link to={`/profile/${authUser.authData?._id}`} className=\"flex items-center justify-center gap-3\">\r\n                    <img src={authUser.authData?.imageUrl} alt={authUser.authData?.imageUrl} className=\"h-12 w-12 rounded-md object-cover bg-pruple-400\"  />\r\n                    <div className=\"flex flex-col justify-center\">\r\n                    <h1 className=\"text-md font-semibold\">{authUser.authData?.firstname} {authUser.authData?.lastname}</h1>\r\n                        <p className=\"text-sm text-gray-200\">{authUser.authData?.email}</p>\r\n                    </div>\r\n                </Link>\r\n                }\r\n            </div> \r\n            \r\n            <CreatePost handleSubmit={handleSubmit} postData={postData} setpostData={setpostData} post={post} modalOpen={modalOpen} setModalOpen={setModalOpen} handleBlob={handleBlob} setBlob={setBlob} blob={blob}/>\r\n    \r\n            {/* posts  */}\r\n    \r\n                {post?.posts.length === 0 ?  <PostLoading /> :\r\n                    <div className=\"space-y-5\">\r\n                    {post.posts.map((postx, index) => {\r\n                        \r\n                        if(post?.posts.length === index + 1){\r\n                         \r\n                            return ( <div key={postx._id} ref={lastBookElementRef}>\r\n                                        <Post post={postx} />\r\n                                    </div> )\r\n\r\n                        } else if(postx === 0){\r\n                            return null\r\n                        }\r\n                            else{\r\n                            return ( <div key={postx._id}>\r\n                                        <Post post={postx} />\r\n                                     </div>)\r\n                        }\r\n                       \r\n                        })\r\n                    }    \r\n                    {!hasMore && <p className=\"text-center text-sm\">There are no more posts to show right now.</p>}\r\n                    {post.loading && <PostLoading/>}\r\n                    </div>\r\n            }\r\n            \r\n        </div>\r\n\r\n\r\n\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Middle;\r\n"]},"metadata":{},"sourceType":"module"}