{"ast":null,"code":"import _slicedToArray from\"C:/Users/Lim/Desktop/Clone/login-mern/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useRef,useCallback}from'react';import{useSelector}from'react-redux';import{useHistory,Link}from'react-router-dom';import{useDispatch}from'react-redux';import{createPost}from'../../../redux/actions/post';import Post from'./Post/Post';import CreatePost from'../../layout/CreatePost';import PostLoading from'../../layout/Skeleton Loading/Post';import Search from'../../layout/Search';import MobileProfile from'../../layout/Skeleton Loading/MobileProfile';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var initialState={description:'',postImg:''};var Middle=function Middle(){var _authUser$authData,_authUser$authData2,_authUser$authData3,_authUser$authData4,_authUser$authData5,_authUser$authData6;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),modalOpen=_useState2[0],setModalOpen=_useState2[1];var _useState3=useState(initialState),_useState4=_slicedToArray(_useState3,2),postData=_useState4[0],setpostData=_useState4[1];var _useState5=useState(1),_useState6=_slicedToArray(_useState5,2),pageNumber=_useState6[0],setPageNumber=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),hasMore=_useState8[0],setHasMore=_useState8[1];var authUser=useSelector(function(state){return state.auth;});var post=useSelector(function(state){return state.posts;});var history=useHistory();var dispatch=useDispatch();var clear=function clear(){setpostData({description:'',postImg:''});};var handleSubmit=function handleSubmit(e){e.preventDefault();if(postData.description===''&&postData.postImg===''){alert('Posting without a content is not allowed!');}else{dispatch(createPost(postData,setModalOpen));}clear();};//turn the post state to an empty array every first render \nuseEffect(function(){dispatch({type:'RESET_POSTS'});},[dispatch]);useEffect(function(){// dispatch(fetchPostsLimit(history, pageNumber, setHasMore, CancelToken, cancel));\n// this cancelToken is for cancelling an API request everytime the components unmount\nvar CancelToken=axios.CancelToken;var cancel;dispatch({type:'POSTS_LOADING'});axios.get(\"/post/post?page=\".concat(pageNumber),{cancelToken:new CancelToken(function executor(c){// An executor function receives a cancel function as a parameter\ncancel=c;})}).then(function(_ref){var data=_ref.data;setHasMore(data.result.length>0);dispatch({type:'POSTS',payload:data});}).catch(function(error){if(axios.isCancel(error)){console.log('Request Canceled sa post!');}else{var _error$response;dispatch({type:'ERRORS',payload:error});if(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401){dispatch({type:'LOGOUT'});history.push('/login');}}});return function(){return cancel();};},[dispatch,history,pageNumber]);var observer=useRef();var lastBookElementRef=useCallback(function(node){if(post.loading)return;if(observer.current)observer.current.disconnect();observer.current=new IntersectionObserver(function(entries){if(entries[0].isIntersecting&&hasMore){setPageNumber(function(prevPageNumber){return prevPageNumber+1;});}},{rootMargin:\"-150px\"});if(node)observer.current.observe(node);},[post.loading,hasMore]);return/*#__PURE__*/_jsxs(\"div\",{className:\"lg:col-span-9 xl:col-span-6 col-span-full space-y-3 mb-16 md:mb-0\",children:[/*#__PURE__*/_jsx(Search,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4 md:space-y-5\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-2 md:hidden\",children:(authUser===null||authUser===void 0?void 0:authUser.loading)?/*#__PURE__*/_jsx(MobileProfile,{}):/*#__PURE__*/_jsxs(Link,{to:\"/profile/\".concat((_authUser$authData=authUser.authData)===null||_authUser$authData===void 0?void 0:_authUser$authData._id),className:\"flex items-center justify-center gap-3\",children:[/*#__PURE__*/_jsx(\"img\",{src:(_authUser$authData2=authUser.authData)===null||_authUser$authData2===void 0?void 0:_authUser$authData2.imageUrl,alt:(_authUser$authData3=authUser.authData)===null||_authUser$authData3===void 0?void 0:_authUser$authData3.imageUrl,className:\"h-12 w-12 rounded-md object-cover bg-pruple-400\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col justify-center\",children:[/*#__PURE__*/_jsxs(\"h1\",{className:\"text-md font-semibold\",children:[(_authUser$authData4=authUser.authData)===null||_authUser$authData4===void 0?void 0:_authUser$authData4.firstname,\" \",(_authUser$authData5=authUser.authData)===null||_authUser$authData5===void 0?void 0:_authUser$authData5.lastname]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-200\",children:(_authUser$authData6=authUser.authData)===null||_authUser$authData6===void 0?void 0:_authUser$authData6.email})]})]})}),/*#__PURE__*/_jsx(CreatePost,{handleSubmit:handleSubmit,postData:postData,setpostData:setpostData,post:post,modalOpen:modalOpen,setModalOpen:setModalOpen}),(post===null||post===void 0?void 0:post.posts.length)===0?/*#__PURE__*/_jsx(PostLoading,{}):/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-5\",children:[post.posts.map(function(postx,index){if((post===null||post===void 0?void 0:post.posts.length)===index+1){return/*#__PURE__*/_jsx(\"div\",{ref:lastBookElementRef,children:/*#__PURE__*/_jsx(Post,{post:postx})},postx._id);}else if(postx===0){return null;}else{return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Post,{post:postx})},postx._id);}}),!hasMore&&/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-sm\",children:\"There are no more posts to show right now.\"}),post.loading&&/*#__PURE__*/_jsx(PostLoading,{})]})]})]});};export default Middle;","map":{"version":3,"sources":["C:/Users/Lim/Desktop/Clone/login-mern/client/src/components/Homepage/components/Middle.js"],"names":["React","useState","useEffect","useRef","useCallback","useSelector","useHistory","Link","useDispatch","createPost","Post","CreatePost","PostLoading","Search","MobileProfile","axios","initialState","description","postImg","Middle","modalOpen","setModalOpen","postData","setpostData","pageNumber","setPageNumber","hasMore","setHasMore","authUser","state","auth","post","posts","history","dispatch","clear","handleSubmit","e","preventDefault","alert","type","CancelToken","cancel","get","cancelToken","executor","c","then","data","result","length","payload","catch","error","isCancel","console","log","response","status","push","observer","lastBookElementRef","node","loading","current","disconnect","IntersectionObserver","entries","isIntersecting","prevPageNumber","rootMargin","observe","authData","_id","imageUrl","firstname","lastname","email","map","postx","index"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef ,useCallback } from 'react'\r\nimport { useSelector } from 'react-redux';\r\nimport {useHistory, Link} from 'react-router-dom';\r\nimport { useDispatch } from 'react-redux';\r\n\r\nimport {createPost} from '../../../redux/actions/post';\r\n\r\nimport Post from './Post/Post';\r\n\r\nimport CreatePost from '../../layout/CreatePost';\r\nimport PostLoading from '../../layout/Skeleton Loading/Post';\r\nimport Search from '../../layout/Search';\r\nimport MobileProfile from '../../layout/Skeleton Loading/MobileProfile';\r\n\r\nimport axios from 'axios';\r\n\r\nconst initialState = { description: '', postImg: ''};\r\nconst Middle = () => {\r\n\r\n    const [modalOpen, setModalOpen] = useState(false);\r\n    const [postData,setpostData] = useState(initialState);\r\n    const [pageNumber, setPageNumber] = useState(1);\r\n    const [hasMore, setHasMore] = useState(false);\r\n    const authUser = useSelector(state => state.auth);\r\n\r\n    let post = useSelector(state => state.posts);\r\n    const history = useHistory();\r\n    const dispatch = useDispatch();\r\n\r\n    const clear = () => {\r\n        setpostData({description: '', postImg:''});\r\n    }\r\n\r\n    const handleSubmit = (e) => {\r\n        e.preventDefault();\r\n        if(postData.description === '' && postData.postImg === '' ){\r\n            alert('Posting without a content is not allowed!')\r\n        }else{\r\n            dispatch(createPost(postData, setModalOpen));\r\n        }\r\n     \r\n        clear();\r\n    }; \r\n  \r\n\r\n    //turn the post state to an empty array every first render \r\n    useEffect(() => {\r\n        dispatch({type: 'RESET_POSTS'});\r\n    },[dispatch]);\r\n\r\n    useEffect(()=> {\r\n         \r\n        // dispatch(fetchPostsLimit(history, pageNumber, setHasMore, CancelToken, cancel));\r\n\r\n         // this cancelToken is for cancelling an API request everytime the components unmount\r\n         const CancelToken = axios.CancelToken;\r\n         let cancel;\r\n\r\n        dispatch({type:'POSTS_LOADING'});\r\n        axios.get(`/post/post?page=${pageNumber}`, { cancelToken: new CancelToken(function executor(c) {\r\n            // An executor function receives a cancel function as a parameter\r\n            cancel = c;\r\n          }) }).then(({data})=>{\r\n            setHasMore(data.result.length > 0);\r\n            dispatch({type: 'POSTS', payload: data});\r\n        }).catch((error) => {\r\n            if (axios.isCancel(error)) {\r\n                console.log('Request Canceled sa post!'); \r\n            }\r\n            else{\r\n                dispatch({type:'ERRORS', payload: error});\r\n                if(error.response?.status === 401){\r\n                    dispatch({type: 'LOGOUT'});\r\n                    history.push('/login');\r\n                }\r\n            }\r\n        });\r\n\r\n        return () => cancel();\r\n    },[dispatch,history,pageNumber]);\r\n\r\n\r\n    const observer = useRef();\r\n   \r\n    const lastBookElementRef = useCallback((node) => {\r\n        if(post.loading) return \r\n        if(observer.current) observer.current.disconnect();\r\n        observer.current = new IntersectionObserver(entries => {\r\n            if(entries[0].isIntersecting && hasMore){\r\n                setPageNumber(prevPageNumber => prevPageNumber + 1);\r\n            }\r\n        }, {rootMargin: \"-150px\"})\r\n        if(node) observer.current.observe(node);\r\n    },[post.loading, hasMore])\r\n    \r\n    return (\r\n        <div className=\"lg:col-span-9 xl:col-span-6 col-span-full space-y-3 mb-16 md:mb-0\">\r\n            <Search />\r\n            \r\n        <div className=\"space-y-4 md:space-y-5\">\r\n            <div className=\"p-2 md:hidden\">\r\n                {authUser?.loading ? <MobileProfile /> :\r\n                 <Link to={`/profile/${authUser.authData?._id}`} className=\"flex items-center justify-center gap-3\">\r\n                    <img src={authUser.authData?.imageUrl} alt={authUser.authData?.imageUrl} className=\"h-12 w-12 rounded-md object-cover bg-pruple-400\"  />\r\n                    <div className=\"flex flex-col justify-center\">\r\n                    <h1 className=\"text-md font-semibold\">{authUser.authData?.firstname} {authUser.authData?.lastname}</h1>\r\n                        <p className=\"text-sm text-gray-200\">{authUser.authData?.email}</p>\r\n                    </div>\r\n                </Link>\r\n                }\r\n            </div> \r\n            \r\n            <CreatePost handleSubmit={handleSubmit} postData={postData} setpostData={setpostData} post={post} modalOpen={modalOpen} setModalOpen={setModalOpen}/>\r\n    \r\n            {/* posts  */}\r\n    \r\n                {post?.posts.length === 0 ?  <PostLoading /> :\r\n                    <div className=\"space-y-5\">\r\n                    {post.posts.map((postx, index) => {\r\n                        \r\n                        if(post?.posts.length === index + 1){\r\n                         \r\n                            return ( <div key={postx._id} ref={lastBookElementRef}>\r\n                                        <Post post={postx} />\r\n                                    </div> )\r\n\r\n                        } else if(postx === 0){\r\n                            return null\r\n                        }\r\n                            else{\r\n                            return ( <div key={postx._id}>\r\n                                        <Post post={postx} />\r\n                                     </div>)\r\n                        }\r\n                       \r\n                        })\r\n                    }    \r\n                    {!hasMore && <p className=\"text-center text-sm\">There are no more posts to show right now.</p>}\r\n                    {post.loading && <PostLoading/>}\r\n                    </div>\r\n            }\r\n            \r\n        </div>\r\n\r\n\r\n\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Middle;\r\n"]},"metadata":{},"sourceType":"module"}