{"ast":null,"code":"import _slicedToArray from\"C:/Users/Lim/Desktop/Clone/login-mern/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useRef,useCallback}from'react';import{useSelector,useDispatch}from'react-redux';import{useHistory,useParams,useLocation}from'react-router';import UserPost from'./UserPost';import{followUser}from'../../../redux/actions/users';// getUserProfile\n// import { fetchUserPostsLimit } from '../../../redux/actions/post';\nimport loadingCat from\"../../../svg/loadingCat.svg\";import follow from\"../../../svg/follow.svg\";import following from\"../../../svg/following.svg\";import edit from\"../../../svg/edit.svg\";import MainProfileLoading from'../../layout/Skeleton Loading/MainProfile';import PostLoading from'../../layout/Skeleton Loading/Post';import Search from'../../layout/Search';import EditUserProfile from'../../layout/EditUserProfile';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var MiddleProfile=function MiddleProfile(){var _user$user2,_user$user2$followers,_user$user3,_user$user4,_user$user5,_user$user6,_user$user7,_user$user8,_user$user9,_user$user10;var dispatch=useDispatch();var _useParams=useParams(),id=_useParams.id;var history=useHistory();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),modal=_useState2[0],setModal=_useState2[1];var _useState3=useState(1),_useState4=_slicedToArray(_useState3,2),pageNumber=_useState4[0],setPageNumber=_useState4[1];var user=useSelector(function(state){return state.users;});var post=useSelector(function(state){return state.posts;});var authenticatedUserId=useSelector(function(state){return state.auth.authData._id;});var location=useLocation();var observer=useRef();var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),hasMore=_useState6[0],setHasMore=_useState6[1];//turn the post state to an empty array every render \nuseEffect(function(){//since we are making a new request every time we click on a different user we want to set our page number to default value of 1.\nsetPageNumber(1);dispatch({type:'RESET_POSTS'});// dispatch(getUserProfile(id,history));\nvar CancelToken=axios.CancelToken;var cancel;dispatch({type:'USER_LOADING'});axios.get(\"/users/user/\".concat(id),{cancelToken:new CancelToken(function executor(c){cancel=c;})}).then(function(_ref){var data=_ref.data;dispatch({type:'USER',payload:data});}).catch(function(error){if(axios.isCancel(error))console.log('Request Canceled! getting User Profile');dispatch({type:'USERS_ERROR',payload:error});});return function(){return cancel();};},[location,dispatch,id,history]);useEffect(function(){// dispatch(fetchUserPostsLimit(history,id ,pageNumber, setHasMore));\n// this cancelToken is for cancelling an API request everytime the components unmount\nvar CancelToken=axios.CancelToken;var cancel;dispatch({type:'POSTS_LOADING'});axios.get(\"/post/user?user=\".concat(id,\"&page=\").concat(pageNumber),{cancelToken:new CancelToken(function executor(c){// An executor function receives a cancel function as a parameter\ncancel=c;})}).then(function(_ref2){var data=_ref2.data;setHasMore(data.result.length>0);dispatch({type:'POSTS',payload:data});}).catch(function(error){if(axios.isCancel(error)){console.log('Request Canceled!');}else{var _error$response;dispatch({type:'ERRORS',payload:error});if(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401){dispatch({type:'LOGOUT'});history.push('/login');}}});return function(){return cancel();};},[dispatch,history,pageNumber,location,id]);//intersection observer, request another set of posts when reaching the bottom or last post\nvar lastBookElementRef=useCallback(function(node){if(post.loading)return;if(observer.current)observer.current.disconnect();observer.current=new IntersectionObserver(function(entries){if(entries[0].isIntersecting&&hasMore){setPageNumber(function(prevPageNumber){return prevPageNumber+1;});}},{rootMargin:\"-150px\"});if(node)observer.current.observe(node);},[post.loading,hasMore]);var handleFollowUser=function handleFollowUser(){var _user$user;dispatch(followUser((_user$user=user.user)===null||_user$user===void 0?void 0:_user$user._id));};var followOrfollowing=(_user$user2=user.user)===null||_user$user2===void 0?void 0:(_user$user2$followers=_user$user2.followers)===null||_user$user2$followers===void 0?void 0:_user$user2$followers.some(function(followerx){return followerx.user===authenticatedUserId;});var ButtonFollowOrFollowing=function ButtonFollowOrFollowing(){if(followOrfollowing){return/*#__PURE__*/_jsx(\"button\",{className:\"bg-button2 hover:bg-opacity-100 active:bg-opacity-80 transition  ease-out duration-100 text-sm font-light px-6 py-1 rounded-full flex gap-2 items-center justify-center\",onClick:handleFollowUser,children:user.userFollowingLoading?/*#__PURE__*/_jsx(\"img\",{src:loadingCat,alt:\"\",className:\"h-5 w-5 m-auto\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"img\",{src:following,alt:\"\",className:\"h-4 w-4 m-auto\"})}),\" \",/*#__PURE__*/_jsx(\"span\",{children:\"Following\"})]})});}else{return/*#__PURE__*/_jsx(\"button\",{className:\"bg-button2 hover:bg-opacity-100 active:bg-opacity-80 transition  ease-out duration-100 text-sm font-light px-6 py-1 rounded-full flex gap-2 items-center justify-center\",onClick:handleFollowUser,children:user.userFollowingLoading?/*#__PURE__*/_jsx(\"img\",{src:loadingCat,alt:\"\",className:\"h-5 w-5 m-auto\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"img\",{src:follow,alt:\"\",className:\"h-4 w-4 m-auto\"})}),\" \",/*#__PURE__*/_jsx(\"span\",{children:\"Follow\"})]})});}};var FollowersOrFollow=function FollowersOrFollow(){var _user$user$followers;if(((_user$user$followers=user.user.followers)===null||_user$user$followers===void 0?void 0:_user$user$followers.length)>1){var _user$user$followers2;return/*#__PURE__*/_jsxs(\"span\",{children:[\" \",(_user$user$followers2=user.user.followers)===null||_user$user$followers2===void 0?void 0:_user$user$followers2.length,\" followers \"]});}else{var _user$user$followers3;return/*#__PURE__*/_jsxs(\"span\",{children:[(_user$user$followers3=user.user.followers)===null||_user$user$followers3===void 0?void 0:_user$user$followers3.length,\" follower\"]});}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"lg:col-span-9 xl:col-span-6 col-span-full space-y-4 mb-16 md:mb-0\",children:[/*#__PURE__*/_jsx(Search,{}),user.userLoading?/*#__PURE__*/_jsx(MainProfileLoading,{}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"w-full h-56 rounded-t-md overflow-y-contain relative\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-black bg-opacity-20 absolute inset-0\"}),((_user$user3=user.user)===null||_user$user3===void 0?void 0:_user$user3.coverPhoto)&&/*#__PURE__*/_jsx(\"img\",{src:(_user$user4=user.user)===null||_user$user4===void 0?void 0:_user$user4.coverPhoto,alt:\"\",className:\"w-full h-full object-cover border-none\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center flex-col sm:flex-row sm:justify-between bg-primary rounded-b-md\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col justify-center items-center gap-3 px-4 pt-2 pb-1 md:pb-none sm:pb-5 z-10 sm:flex-row sm:justify-start\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"-mt-20 flex-shrink-0 \",children:/*#__PURE__*/_jsx(\"img\",{src:(_user$user5=user.user)===null||_user$user5===void 0?void 0:_user$user5.imageUrl,alt:\"\",className:\"rounded-full h-28 w-28 border-4 border-borderProfile object-cover relative bg-purple-400\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center sm:text-left space-y-1\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h1\",{className:\"text-lg font-semibold\",children:[(_user$user6=user.user)===null||_user$user6===void 0?void 0:_user$user6.firstname,\" \",(_user$user7=user.user)===null||_user$user7===void 0?void 0:_user$user7.lastname]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-300\",children:(_user$user8=user.user)===null||_user$user8===void 0?void 0:_user$user8.email})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-md text-gray-300 font-light\",children:[\" \",/*#__PURE__*/_jsx(FollowersOrFollow,{}),\" \"]})]})]}),((_user$user9=user.user)===null||_user$user9===void 0?void 0:_user$user9._id)===authenticatedUserId?null:/*#__PURE__*/_jsx(\"div\",{className:\"p-3 flex items-start justify-center\",children:/*#__PURE__*/_jsx(ButtonFollowOrFollowing,{})})]}),((_user$user10=user.user)===null||_user$user10===void 0?void 0:_user$user10._id)===authenticatedUserId&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"button\",{className:\"bg-primary border-borderColor border w-full flex gap-2 justify-center items-center p-3 rounded-md\",onClick:function onClick(){return setModal(function(prev){return!prev;});},children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"img\",{src:edit,alt:\"edit\",className:\"h-5 w-5 m-auto\"})}),/*#__PURE__*/_jsx(\"p\",{children:\"Edit Profile\"})]})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:post.loading&&(post===null||post===void 0?void 0:post.posts.length)===0?/*#__PURE__*/_jsx(PostLoading,{}):/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-5\",children:[post.posts.map(function(postx,index){if((post===null||post===void 0?void 0:post.posts.length)===index+1){return/*#__PURE__*/_jsx(\"div\",{ref:lastBookElementRef,children:/*#__PURE__*/_jsx(UserPost,{post:postx})},postx._id);}else if(postx===0){return null;}else{return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(UserPost,{post:postx})},postx._id);}}),!hasMore&&(post===null||post===void 0?void 0:post.posts.length)>0?/*#__PURE__*/_jsx(\"p\",{className:\"text-center font-light text-sm\",children:\"There are no more posts to show right now.\"}):(post===null||post===void 0?void 0:post.posts.length)===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-center font-light text-sm\",children:\"No post found..\"}):null,post.loading&&/*#__PURE__*/_jsx(PostLoading,{})]})})]}),modal&&/*#__PURE__*/_jsx(EditUserProfile,{setModal:setModal,userInfo:user})]});};export default MiddleProfile;","map":{"version":3,"sources":["C:/Users/Lim/Desktop/Clone/login-mern/client/src/components/Profile/components/MiddleProfile.js"],"names":["React","useState","useEffect","useRef","useCallback","useSelector","useDispatch","useHistory","useParams","useLocation","UserPost","followUser","MainProfileLoading","PostLoading","Search","EditUserProfile","axios","MiddleProfile","dispatch","id","history","modal","setModal","pageNumber","setPageNumber","user","state","users","post","posts","authenticatedUserId","auth","authData","_id","location","observer","hasMore","setHasMore","type","CancelToken","cancel","get","cancelToken","executor","c","then","data","payload","catch","error","isCancel","console","log","result","length","response","status","push","lastBookElementRef","node","loading","current","disconnect","IntersectionObserver","entries","isIntersecting","prevPageNumber","rootMargin","observe","handleFollowUser","followOrfollowing","followers","some","followerx","ButtonFollowOrFollowing","userFollowingLoading","loadingCat","following","follow","FollowersOrFollow","userLoading","coverPhoto","imageUrl","firstname","lastname","email","prev","edit","map","postx","index"],"mappings":"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","sourcesContent":["import React,{useState, useEffect, useRef, useCallback} from 'react';\r\nimport { useSelector,useDispatch } from 'react-redux';\r\nimport { useHistory, useParams, useLocation } from 'react-router';\r\n\r\nimport UserPost from './UserPost';\r\n\r\nimport { followUser } from '../../../redux/actions/users';\r\n// getUserProfile\r\n// import { fetchUserPostsLimit } from '../../../redux/actions/post';\r\n\r\nimport loadingCat from '../../../svg/loadingCat.svg';\r\nimport follow from '../../../svg/follow.svg';\r\nimport following from '../../../svg/following.svg';\r\nimport edit from '../../../svg/edit.svg';\r\n\r\nimport MainProfileLoading from '../../layout/Skeleton Loading/MainProfile';\r\nimport PostLoading from '../../layout/Skeleton Loading/Post';\r\nimport Search from '../../layout/Search';\r\nimport EditUserProfile from '../../layout/EditUserProfile';\r\n\r\n\r\nimport axios from 'axios';\r\n\r\nconst MiddleProfile = () => {\r\n    const dispatch = useDispatch();\r\n    const {id} = useParams();\r\n    const history = useHistory();\r\n    const [modal,setModal] = useState(false);\r\n    const [pageNumber, setPageNumber] = useState(1);\r\n    const user = useSelector(state => state.users);\r\n    const post = useSelector(state => state.posts);\r\n    const authenticatedUserId = useSelector(state => state.auth.authData._id);\r\n    const location = useLocation();\r\n    const observer = useRef();\r\n    const [hasMore, setHasMore] = useState(false);\r\n   //turn the post state to an empty array every render \r\n   useEffect(() => {\r\n        //since we are making a new request every time we click on a different user we want to set our page number to default value of 1.\r\n        setPageNumber(1);\r\n        dispatch({type: 'RESET_POSTS'});\r\n\r\n        // dispatch(getUserProfile(id,history));\r\n\r\n        const CancelToken = axios.CancelToken;\r\n        let cancel;\r\n        dispatch({type: 'USER_LOADING'});\r\n        axios.get(`/users/user/${id}`,{cancelToken: new CancelToken(function executor(c){\r\n            cancel = c;\r\n        })}).then(({data}) => {\r\n            dispatch ({type: 'USER', payload: data});\r\n        }).catch((error) => {\r\n            if(axios.isCancel(error)) console.log('Request Canceled! getting User Profile')\r\n            dispatch({type: 'USERS_ERROR', payload: error});\r\n        })\r\n        return () => cancel();\r\n    },[location,dispatch,id, history]);\r\n\r\n    useEffect(()=> {\r\n        // dispatch(fetchUserPostsLimit(history,id ,pageNumber, setHasMore));\r\n\r\n        // this cancelToken is for cancelling an API request everytime the components unmount\r\n        const CancelToken = axios.CancelToken;\r\n        let cancel;\r\n\r\n        dispatch({type:'POSTS_LOADING'});\r\n        axios.get(`/post/user?user=${id}&page=${pageNumber}`, { cancelToken: new CancelToken(function executor(c) {\r\n            // An executor function receives a cancel function as a parameter\r\n            cancel = c;\r\n          }) }).then(({data})=>{\r\n            setHasMore(data.result.length > 0);\r\n            dispatch({type: 'POSTS', payload: data});\r\n        }).catch((error) => {\r\n            if (axios.isCancel(error)) {\r\n                console.log('Request Canceled!'); \r\n            }\r\n            else{\r\n                dispatch({type:'ERRORS', payload: error});\r\n                if(error.response?.status === 401){\r\n                    dispatch({type: 'LOGOUT'});\r\n                    history.push('/login');\r\n                }\r\n            }\r\n        });\r\n\r\n        return () => cancel();\r\n    },[dispatch, history, pageNumber,location,id]);\r\n\r\n    //intersection observer, request another set of posts when reaching the bottom or last post\r\n   \r\n    const lastBookElementRef = useCallback((node) => {\r\n        if(post.loading) return \r\n        if(observer.current) observer.current.disconnect();\r\n        observer.current = new IntersectionObserver(entries => {    \r\n            if(entries[0].isIntersecting && hasMore){\r\n                setPageNumber(prevPageNumber => prevPageNumber + 1);\r\n            }\r\n        }, {rootMargin: \"-150px\"})\r\n        if(node) observer.current.observe(node);\r\n    },[post.loading, hasMore])\r\n\r\n\r\n\r\n    const handleFollowUser = () => {\r\n        dispatch(followUser(user.user?._id)); \r\n    }\r\n \r\n    const followOrfollowing = user.user?.followers?.some(followerx => followerx.user === authenticatedUserId)\r\n    const ButtonFollowOrFollowing = () => {\r\n        if(followOrfollowing){\r\n            return <button className=\"bg-button2 hover:bg-opacity-100 active:bg-opacity-80 transition  ease-out duration-100 text-sm font-light px-6 py-1 rounded-full flex gap-2 items-center justify-center\" onClick={handleFollowUser} >\r\n            {user.userFollowingLoading ? <img src={loadingCat} alt=\"\" className=\"h-5 w-5 m-auto\" /> : \r\n                <>\r\n                    <div className=\"flex-shrink-0\"><img src={following} alt=\"\" className=\"h-4 w-4 m-auto\" /></div> <span>Following</span>\r\n                </>\r\n            }\r\n            </button>\r\n        \r\n        }else{\r\n            return <button className=\"bg-button2 hover:bg-opacity-100 active:bg-opacity-80 transition  ease-out duration-100 text-sm font-light px-6 py-1 rounded-full flex gap-2 items-center justify-center\" onClick={handleFollowUser}>\r\n                {user.userFollowingLoading ? <img src={loadingCat} alt=\"\" className=\"h-5 w-5 m-auto\" /> : \r\n                    <>\r\n                        <div className=\"flex-shrink-0\"><img src={follow} alt=\"\" className=\"h-4 w-4 m-auto\" /></div> <span>Follow</span>\r\n                    </>\r\n                }\r\n            </button>\r\n        }\r\n\r\n    }\r\n    const FollowersOrFollow = () => {\r\n        if(user.user.followers?.length > 1){\r\n            return <span> {user.user.followers?.length} followers </span>\r\n        }else{\r\n            return <span>{user.user.followers?.length} follower</span>\r\n        }\r\n    }\r\n  \r\n    return (\r\n    <>\r\n        <div className=\"lg:col-span-9 xl:col-span-6 col-span-full space-y-4 mb-16 md:mb-0\">\r\n            <Search />\r\n\r\n            {/* USER PROFILE SECTION */}\r\n            {/*  */}\r\n            {user.userLoading ?  <MainProfileLoading /> :   \r\n                <div>\r\n                    {/* cover image section */}\r\n                    <div className=\"w-full h-56 rounded-t-md overflow-y-contain relative\">\r\n                        {/* overlay */}\r\n                        <div className=\"bg-black bg-opacity-20 absolute inset-0\"></div>\r\n\r\n                        {/* checks if theres a cover photo */}\r\n                        {user.user?.coverPhoto && <img src={user.user?.coverPhoto} alt=\"\" className=\"w-full h-full object-cover border-none\" /> }   \r\n                        \r\n                    </div>\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"flex justify-center flex-col sm:flex-row sm:justify-between bg-primary rounded-b-md\">\r\n                            <div className=\"flex flex-col justify-center items-center gap-3 px-4 pt-2 pb-1 md:pb-none sm:pb-5 z-10 sm:flex-row sm:justify-start\">\r\n                                <div className=\"-mt-20 flex-shrink-0 \">\r\n                                    <img src={user.user?.imageUrl} alt=\"\" className=\"rounded-full h-28 w-28 border-4 border-borderProfile object-cover relative bg-purple-400\" />\r\n                                </div>\r\n                                <div className=\"text-center sm:text-left space-y-1\">\r\n                                    <div>\r\n                                        <h1 className=\"text-lg font-semibold\">{user.user?.firstname} {user.user?.lastname}</h1>\r\n                                        <p className=\"text-sm text-gray-300\">{user.user?.email}</p>\r\n                                    </div>\r\n                                    <p className=\"text-md text-gray-300 font-light\"> <FollowersOrFollow/> </p>\r\n                                </div>\r\n                            \r\n                            </div>\r\n                            \r\n                            {user.user?._id === authenticatedUserId ?\r\n                                    null :   \r\n                                    <div className=\"p-3 flex items-start justify-center\">\r\n                                      <ButtonFollowOrFollowing />\r\n                                    </div>\r\n                                }\r\n                            \r\n                        </div>\r\n                        {/* Edit Profile */}\r\n                        {user.user?._id === authenticatedUserId && \r\n                        <>\r\n                            <button className=\"bg-primary border-borderColor border w-full flex gap-2 justify-center items-center p-3 rounded-md\" onClick={() => setModal(prev => !prev)}>\r\n                                <div>\r\n                                    <img src={edit} alt=\"edit\" className=\"h-5 w-5 m-auto\" />\r\n                                </div>\r\n                                <p>Edit Profile</p>\r\n                            </button>\r\n                        </>\r\n                        }\r\n                    </div>\r\n\r\n                </div>\r\n                \r\n            }\r\n            \r\n            {/* END USER PROFILE SECTION */}\r\n        \r\n            {/* USER POST */}\r\n            <div className=\"space-y-4\">\r\n                {  \r\n                post.loading && post?.posts.length === 0 ? <PostLoading/> :\r\n                   <div className=\"space-y-5\">\r\n                   {post.posts.map((postx, index) => {\r\n                       if(post?.posts.length === index + 1){\r\n                           return (  <div key={postx._id} ref={lastBookElementRef}>\r\n                                        <UserPost post={postx} />\r\n                                   </div> \r\n                               )\r\n                       } else if( postx === 0){\r\n                        return null\r\n                        }\r\n                       else{\r\n                           return ( <div key={postx._id}>\r\n                                        <UserPost post={postx} />\r\n                                    </div>)\r\n                       }\r\n                       })\r\n                   }    \r\n                   {!hasMore && post?.posts.length > 0? <p className=\"text-center font-light text-sm\">There are no more posts to show right now.</p> : post?.posts.length === 0 ? <p className=\"text-center font-light text-sm\">No post found..</p> : null }\r\n                   {post.loading && <PostLoading/>} \r\n                   </div>\r\n                    \r\n                }\r\n            </div>\r\n            {/* END USER POST */} \r\n        </div>\r\n        \r\n        {modal && <EditUserProfile setModal={setModal} userInfo={user}/>} \r\n    </>\r\n    )\r\n}\r\n\r\nexport default MiddleProfile\r\n"]},"metadata":{},"sourceType":"module"}