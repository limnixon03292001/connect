{"ast":null,"code":"import _objectSpread from\"C:/Users/Lim/Desktop/Clone/login-mern/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _objectWithoutProperties from\"C:/Users/Lim/Desktop/Clone/login-mern/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";var _excluded=[\"component\"];import React,{useEffect}from'react';import{Route,Redirect,useHistory}from'react-router-dom';import MobileNav from'../layout/MobileNav';import decode from'jwt-decode';import{useDispatch,useSelector}from'react-redux';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PrivateRoute=function PrivateRoute(_ref){var Component=_ref.component,rest=_objectWithoutProperties(_ref,_excluded);var dispatch=useDispatch();var history=useHistory();var page=useSelector(function(state){return state.users.page;});var pageFollowers=useSelector(function(state){return state.users.pageFollowers;});//For fetching authenticated user\nuseEffect(function(){var CancelToken=axios.CancelToken;var cancel;dispatch({type:'LOADING'});axios.get(\"/login/user\",{cancelToken:new CancelToken(function executor(c){cancel=c;})}).then(function(_ref2){var data=_ref2.data;dispatch({type:'INSERT_USER',payload:data.result});}).catch(function(error){if(axios.isCancel(error))console.log(\"Request Canceled, fetching autheticated user\");dispatch({type:'ERROR',payload:error});});return function(){cancel();dispatch({type:'SETPAGE_DEFAULT'});dispatch({type:'SETPAGEFOLLOWERS_DEFAULT'});dispatch({type:'CLEAR_USERS'});};},[dispatch]);//For fetching all users\nuseEffect(function(){// Cancelling axios request\nvar CancelToken=axios.CancelToken;var cancel;dispatch({type:'USERS_LOADING'});axios.get(\"/users/all?page=\".concat(page),{cancelToken:new CancelToken(function executor(c){cancel=c;})}).then(function(_ref3){var data=_ref3.data;dispatch({type:'USERS',payload:data});}).catch(function(error){var _error$response;if(axios.isCancel(error))console.log('Request Canceled users');if(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401){dispatch({type:'LOGOUT'});history.push('/login');}});return function(){return cancel();};},[dispatch,history,page]);//for fetching current users followers\nuseEffect(function(){var CancelToken=axios.CancelToken;var cancel;dispatch({type:'USER_FOLLOWERS_LOADING'});axios.get(\"/users/followers?page=\".concat(pageFollowers),{cancelToken:new CancelToken(function executor(c){cancel=c;})}).then(function(_ref4){var data=_ref4.data;dispatch({type:'USERS_FOLLOWERS',payload:data});}).catch(function(error){if(axios.isCancel(error))console.log(\"Reques Canceled, fetching user's follower\");dispatch({type:'USERS_ERROR',payload:error.message});});return function(){return cancel();};},[dispatch,pageFollowers]);var checkToken=function checkToken(){var token=localStorage.token;if(token){var decodedToken=decode(token);if(decodedToken.exp*1000<new Date().getTime()){localStorage.removeItem('token');return false;}else{return true;}}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Route,_objectSpread(_objectSpread({},rest),{},{render:function render(props){if(!checkToken()){return/*#__PURE__*/_jsx(Redirect,{to:\"/login\"});}else{return/*#__PURE__*/_jsx(Component,_objectSpread({},props));}}})),/*#__PURE__*/_jsx(MobileNav,{})]});};export default PrivateRoute;","map":{"version":3,"sources":["C:/Users/Lim/Desktop/Clone/login-mern/client/src/components/PrivateRoutes/PrivateRoute.js"],"names":["React","useEffect","Route","Redirect","useHistory","MobileNav","decode","useDispatch","useSelector","axios","PrivateRoute","Component","component","rest","dispatch","history","page","state","users","pageFollowers","CancelToken","cancel","type","get","cancelToken","executor","c","then","data","payload","result","catch","error","isCancel","console","log","response","status","push","message","checkToken","token","localStorage","decodedToken","exp","Date","getTime","removeItem","props"],"mappings":"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","sourcesContent":["import React, {useEffect} from 'react'\r\nimport { Route, Redirect, useHistory } from 'react-router-dom';\r\n\r\nimport MobileNav from '../layout/MobileNav';\r\n\r\nimport decode from 'jwt-decode'\r\nimport { useDispatch, useSelector } from 'react-redux';\r\n\r\nimport axios from 'axios';\r\n\r\nconst PrivateRoute = ({component: Component,...rest}) => {\r\n    const dispatch = useDispatch();\r\n    const history = useHistory();\r\n    const page = useSelector(state => state.users.page)\r\n    const pageFollowers = useSelector(state => state.users.pageFollowers);\r\n\r\n    //For fetching authenticated user\r\n    useEffect(() => {\r\n        const CancelToken = axios.CancelToken;\r\n        let cancel;\r\n\r\n        dispatch({type:'LOADING'});\r\n\r\n        axios.get(`/login/user`,{cancelToken: new CancelToken(function executor(c){\r\n            cancel = c;\r\n        })}).then(({data})=>{\r\n            dispatch({type:'INSERT_USER',payload: data.result});\r\n        }).catch((error)=>{\r\n            if(axios.isCancel(error)) console.log(\"Request Canceled, fetching autheticated user\");\r\n            dispatch({type:'ERROR', payload: error});\r\n        })\r\n\r\n        return () =>{\r\n            cancel();\r\n            dispatch({type: 'SETPAGE_DEFAULT'});\r\n            dispatch({type: 'SETPAGEFOLLOWERS_DEFAULT'});\r\n            dispatch({type: 'CLEAR_USERS'});\r\n        } \r\n    },[dispatch]);\r\n\r\n    //For fetching all users\r\n    useEffect(() => {\r\n        // Cancelling axios request\r\n        const CancelToken = axios.CancelToken;\r\n        let cancel;\r\n        dispatch({type:'USERS_LOADING'});\r\n        axios.get(`/users/all?page=${page}`, {cancelToken: new CancelToken(function executor(c){\r\n            cancel = c;\r\n        })}).then(({data}) => {\r\n            dispatch({type: 'USERS', payload: data});\r\n        }).catch((error) => {\r\n            if(axios.isCancel(error)) console.log('Request Canceled users');\r\n            if(error.response?.status === 401){\r\n                dispatch({type: 'LOGOUT'});\r\n                history.push('/login');\r\n            }\r\n        });\r\n        \r\n        return () => cancel();\r\n      \r\n      },[dispatch,history,page]);\r\n\r\n      //for fetching current users followers\r\n      useEffect(() => {\r\n\r\n        const CancelToken = axios.CancelToken;\r\n        let cancel;\r\n        dispatch({type: 'USER_FOLLOWERS_LOADING'});\r\n        axios.get(`/users/followers?page=${pageFollowers}`,{cancelToken: new CancelToken(function executor(c){\r\n            cancel = c;\r\n        })}).then(({data})=> {\r\n            dispatch({type:'USERS_FOLLOWERS', payload: data});\r\n        }).catch((error)=>{\r\n            if(axios.isCancel(error)) console.log(\"Reques Canceled, fetching user's follower\");\r\n            dispatch({type:'USERS_ERROR', payload: error.message});\r\n        });\r\n\r\n        return ()=> cancel(); \r\n    }, [dispatch, pageFollowers]);\r\n\r\n  \r\n    const checkToken = () => {\r\n        const token = localStorage.token;\r\n        if(token){\r\n            const decodedToken = decode(token);\r\n\r\n            if(decodedToken.exp * 1000 < new Date().getTime()){\r\n            \r\n               localStorage.removeItem('token');\r\n              return false;\r\n            }else{\r\n                return true\r\n            }\r\n        }\r\n    }\r\n  \r\n    return (\r\n        <>\r\n            <Route \r\n                {...rest}\r\n                render={props =>{\r\n\r\n                            if(!checkToken()){\r\n                                return <Redirect to=\"/login\" />\r\n                            }\r\n                            else{\r\n                                return <Component {...props} />\r\n                            }  \r\n                        } \r\n                    }  \r\n            />\r\n             <MobileNav />\r\n        </>\r\n        \r\n    )\r\n}\r\n\r\nexport default PrivateRoute\r\n"]},"metadata":{},"sourceType":"module"}